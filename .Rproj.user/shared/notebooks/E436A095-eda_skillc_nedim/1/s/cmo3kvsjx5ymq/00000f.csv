"0","#| echo: false"
"0","# Librairies"
"0","library(readr)"
"0","library(dplyr)"
"0","library(stringr)"
"0","library(tidyr)"
"0","library(lubridate)"
"0",""
"0","# Pour d√©limiter les variables, et pour pouvoir enlever les ? de la base de donn√©es"
"0","data1 <- read_delim(""data/skill.csv"", delim = "";"", "
"0","                    escape_double = FALSE, locale = locale(encoding = ""ISO-8859-1""), "
"0","                    trim_ws = TRUE)"
"2","[1mRows: [22m[34m2921[39m [1mColumns: [22m[34m143[39m"
"2","[36m--[39m [1mColumn specification[22m [36m-----------------------------------------------------------------------------------------------------------------[39m
[1mDelimiter:[22m "";""
[31mchr[39m   (5): Player, Nation, Pos, Squad, Comp
[32mdbl[39m (138): Rk, Age, Born, MP, Starts, Min, 90s, Goals, Shots, SoT, SoT%, G/Sh, G/SoT, ShoDist, ShoFK, ShoPK, PKatt, PasTotCmp, PasTot..."
"2","
[36mi[39m Use `spec()` to retrieve the full column specification for this data.
[36mi[39m Specify the column types or set `show_col_types = FALSE` to quiet this message."
"0","# Enlever les duplications des joueurs comme J√©r√©mie Boga qui √©tait l√† deux fois"
"0","data1 <- data1 %>%"
"0","  distinct(Player, .keep_all = TRUE)"
"0",""
"0","# Ici, je ne garde que les joueurs ayant disput√© au moins 9 matches durant la saison pour ne pas biaiser les r√©sultats, on a choisi 9 en se disant que si un transfert est fait √† la mi-saison, le joueur a jou√© au moins la moiti√© des matches de sa demi-saison."
"0","data1 <- data1 %>%"
"0","  filter(MP >= 9)"
"0",""
"0","# Ici, m√™me chose qu'au dessus mais avec les minutes, on a d√©cid√© de prendre 405 minutes = 9*45, on part du principe que sur les 9 matches d'auparavant, les joueurs ont au moins jou√© une mi-temps par match"
"0","data1 <- data1 %>%"
"0","  filter(Min >= 405)"
"0",""
"0","# Pour ne garder que les joueurs offensives donc qui commencent par Forward donc F"
"0","data1 <- data1 %>%"
"0","  filter(str_detect(Pos, ""^F""))"
"0",""
"0","# Solution complexe mais comme on arrive pas √† changer les ƒá, on cherche tous les noms des joueurs qui posent probl√®mes et les renommons"
"0","# un par un, il n'yen a pas √©norm√©ment"
"0","data1$data_problem <- grepl(""\\?"", data1$Player)"
"0","players_problem <- data1[data1$data_problem, ]"
"0",""
"0","# Remplacer Edin Dzeko"
"0","# Renommer ""Edin D?eko"" en ""Edin D≈æeko"""
"0","data1$Player <- sub(""Edin D\\?eko"", ""Edin D≈æeko"", data1$Player)"
"0",""
"0","# Renommer ""Alfre? Finnbogason"" en ""Alfre√∞ Finnbogason"""
"0","data1$Player <- sub(""Alfre\\? Finnbogason"", ""Alfre√∞ Finnbogason"", data1$Player)"
"0",""
"0","# Renommer ""Albert Gu?mundsson"" en ""Albert Gu√∞mundsson"""
"0","data1$Player <- sub(""Albert Gu\\?mundsson"", ""Albert Gu√∞mundsson"", data1$Player)"
"0",""
"0","# Renommer ""Josip Ili?i?"" en ""Josip Iliƒçiƒá"""
"0","data1$Player <- sub(""Josip Ili\\?i\\?"", ""Josip Iliƒçiƒá"", data1$Player)"
"0",""
"0","# Renommer ""Krzysztof Pi?tek"" en ""Krzysztof PiƒÖtek"""
"0","data1$Player <- sub(""Krzysztof Pi\\?tek"", ""Krzysztof PiƒÖtek"", data1$Player)"
"0",""
"0","# Renommer ""Przemys?aw P?acheta"" en ""Przemys≈Çaw P≈Çacheta"""
"0","data1$Player <- sub(""Przemys\\?aw P\\?acheta"", ""Przemys≈Çaw P≈Çacheta"", data1$Player)"
"0",""
"0","# Renommer ""Duan Vlahovi?"" en ""Du≈°an Vlahoviƒá"", mani√®re diff√©rente car probl√®me diff√©rent, le nom pr√©sente un espace pour on ne sait quelle raison"
"0","data1$Player <- ifelse(data1$Rk == 2801, ""Du≈°an Vlahoviƒá"", data1$Player)"
"0",""
"0","# Renommer ""Nikola Vla?i?"" en ""Nikola Vla≈°iƒá"", mani√®re diff√©rente car probl√®me diff√©rent, le nom pr√©sente un espace pour on ne sait quelle raison"
"0","data1$Player <- ifelse(data1$Rk == 2803, ""Nikola Vla≈°iƒá"", data1$Player)"
"0",""
"0","# Renommer ""Mat?j Vydra"" en ""Matƒõj Vydra"""
"0","data1$Player <- sub(""Mat\\?j Vydra"", ""Matƒõj Vydra"", data1$Player)"
"0",""
"0","# Renommer ""Milan ?uri?"" en ""Milan ƒêuriƒá"""
"0","data1$Player <- sub(""Milan \\?uri\\?"", ""Milan ƒêuriƒá"", data1$Player)"
"0",""
"0","# Renommer et ajouter aux derniers auquel il manquait le ƒá"
"0","data1$Player <- gsub(""\\?"", ""ƒá"", data1$Player)"
"0",""
"0","# Load du dataset fifa 21 pour ajouter les colonnes Height et Weight"
"0","data_fifa_21 <- read_csv(""data/fifa21.csv"")"
"2","[1mRows: [22m[34m19117[39m [1mColumns: [22m[34m60[39m"
"2","[36m--[39m [1mColumn specification[22m [36m-----------------------------------------------------------------------------------------------------------------[39m
[1mDelimiter:[22m "",""
[31mchr[39m (14): Name, Natinality, PreferredFoot, BirthDate, PreferredPositions, PlayerWorkRate, Nation, Nation_Position, Club, Club_Positio...
[32mdbl[39m (46): ID, Overal, Potential, Height, Weight, Age, WeakFoot, SkillMoves, Value, Wage, Nation_KitNumber, Club_KitNumber, BallContro..."
"2","
[36mi[39m Use `spec()` to retrieve the full column specification for this data.
[36mi[39m Specify the column types or set `show_col_types = FALSE` to quiet this message."
"0","# faire en sorte d'avoir Player dans les deux bases de donn√©es pour faciliter le fait de joindre"
"0","data_fifa_21 <- data_fifa_21 %>%"
"0","  rename(Player = Name)"
"0",""
"0","# Rajouter le poids et la taille gr√¢ce √† la deuxi√®me base de donn√©es"
"0","data1 <- data1 %>%"
"0","  left_join(data_fifa_21 %>% select(Player, Height, Weight), by = ""Player"")"
"0",""
"0","# Afin d'avoir une liste de quel joueur n'a pas sa taille et poids"
"0","height_na <- data1 %>%"
"0","  filter(is.na(Height))"
"0",""
"0","# Tentative de s√©parer les noms pour essayer de diminuer les NA"
"0","data1 <- data1 %>%"
"0","  separate(Player, into = c(""Surname"", ""Name""), sep = "" "", extra = ""merge"")"
"2","Warning: Expected 2 pieces. Missing pieces filled with `NA` in 30 rows [12, 20, 39, 53, 86, 205, 206, 207, 211, 212, 215, 224, 264, 268, 284, 303, 327, 328, 329, 330, ...]."
"0","data_fifa_21 <- data_fifa_21 %>%"
"0","  separate(Player, into = c(""Surname"", ""Name""), sep = "" "", extra = ""merge"")"
"2","Warning: Expected 2 pieces. Missing pieces filled with `NA` in 803 rows [6, 20, 31, 38, 45, 46, 52, 56, 72, 77, 80, 88, 89, 90, 93, 120, 122, 131, 132, 136, ...]."
"0","# Joindre pour diminuer les NA en utilisant cette fois uniquement le Name venant de Player, pour la raison que certains joueurs ont des noms compos√©s"
"0","# et que certains pr√©noms comme Sehrou/Serhou Guirassy sont diff√©rents dans les deux bases de donn√©es"
"0","data1 <- data1 %>%"
"0","  left_join(data_fifa_21 %>% select(Name, Height, Weight), by = ""Name"") %>%"
"0","  mutate("
"0","    Height = coalesce(Height.x, Height.y),"
"0","    Weight = coalesce(Weight.x, Weight.y)"
"0","  ) %>%"
"0","  select(-Height.x, -Weight.x, -Height.y, -Weight.y)"
"2","Warning: Detected an unexpected many-to-many relationship between `x` and `y`."
"0","data1 <- data1 %>%"
"0","  distinct(Name, .keep_all = TRUE)"
"0",""
"0","# Mettre en avant les tailles et poids pour ne pas avoir √† passer 200 colonnes"
"0","data1 <- data1 %>%"
"0","  select(Rk, Surname, Name, Nation, Pos, Squad, Comp, Age, Born, Height, Weight, everything())"
"0",""
"0","# Afin d'avoir une liste de quel joueur n'a pas sa taille et poids"
"0","height_na <- data1 %>%"
"0","  filter(is.na(Height))"
"0",""
"0","# Histoire d'avoir une nouvelle colonne en commun ""Born"", qui est l'ann√©e de naissance"
"0","data_fifa_21 <- data_fifa_21 %>%"
"0","  mutate(Born = year(mdy(BirthDate)))"
"0",""
"0","# Renommer pour avoir en commun dans les deux bases de donn√©es"
"0","data_fifa_21 <- data_fifa_21 %>%"
"0","  rename(Squad = Club)"
"0",""
"0","data1 <- data1 %>%"
"0","  left_join(data_fifa_21 %>% select(Born, Squad, Height, Weight), by = c(""Born"", ""Squad"")) %>%"
"0","  mutate("
"0","    Height = coalesce(Height.x, Height.y),"
"0","    Weight = coalesce(Weight.x, Weight.y)"
"0","  ) %>%"
"0","  select(-Height.x, -Weight.x, -Height.y, -Weight.y)"
"2","Warning: Detected an unexpected many-to-many relationship between `x` and `y`."
"0","# Mettre en avant les tailles et poids pour ne pas avoir √† passer 200 colonnes"
"0","data1 <- data1 %>%"
"0","  select(Rk, Surname, Name, Nation, Pos, Squad, Comp, Age, Born, Height, Weight, everything())"
"0",""
"0","# Afin d'enlever les duplications faites par les √©tapes au dessus"
"0","data1 <- data1 %>%"
"0","  distinct(Name, .keep_all = TRUE)"
"0",""
"0","# Afin d'avoir une liste de quel joueur n'a pas sa taille et poids"
"0","height_na <- data1 %>%"
"0","  filter(is.na(Height))"
"0",""
"0","# Arriv√© ici, on a compris qu'en essayant de diff√©rentes mani√®res, que ce soit par diff√©rentes cl√©s communes entre les bdd comme ""Born"", en ayant s√©par√© ""Player"""
"0","# on arrivera toujours pas √† remplacer les NA de certains joueurs pour diff√©rentes raisons, notamment qu'entre les bdd certains noms sont complets, d'autres que Pr√©noms et Noms"
"0","# Il y aussi des probl√®mes avec des noms compos√©s donc avec des ""-"", mais aussi des Pr√©noms et Noms diff√©rents entres les bdd comme ""Sehrou Guirassy"" et ""Serhou Guirassy"""
"0","# On est donc parti du principe qu'avec la liste de height_na qu'on a la plupart des joueurs ne sont pas d'une √©norme importance pour l'analyse future"
"0","# ainsi nous avons d√©cid√© de mettre manuellement les valeurs pour les joueurs nous int√©ressant et de drop les NA restantes."
"0",""
"0","# Comme crit√®re de choix des joueurs √† faire individuellement, nous avons pris le meilleur Goals (90') de chaque championnat"
"0",""
"0","# Heung-Min Son"
"0","data1 <- data1 %>%"
"0","  mutate("
"0","    Height = ifelse(Rk == 1181, 183, Height),"
"0","    Weight = ifelse(Rk == 1181, 76, Weight)"
"0","  )"
"0",""
"0","# Arnaut Danjuma (Groenevelt)"
"0","data1 <- data1 %>%"
"0","  mutate("
"0","    Height = ifelse(Rk == 1074, 187, Height),"
"0","    Weight = ifelse(Rk == 1074, 74, Weight)"
"0","  )"
"0",""
"0","# Sambou Soumano"
"0","data1 <- data1 %>%"
"0","  mutate("
"0","    Height = ifelse(Rk == 2542, 182, Height),"
"0","    Weight = ifelse(Rk == 2542, 70, Weight)"
"0","  )"
"0",""
"0","# Sasa Kalajdzic"
"0","data1 <- data1 %>%"
"0","  mutate("
"0","    Height = ifelse(Rk == 1326, 200, Height),"
"0","    Weight = ifelse(Rk == 1326, 83, Weight)"
"0","  )"
"0",""
"0","# Felix Afena-Gyan"
"0","data1 <- data1 %>%"
"0","  mutate("
"0","    Height = ifelse(Rk == 21, 175, Height),"
"0","    Weight = ifelse(Rk == 21, 75, Weight)"
"0","  )"
"0",""
"0","# Enlever les NA restants"
"0","data1 <- data1 %>%"
"0","  filter(!is.na(Height) & !is.na(Weight))"
"0",""
"0","# Remplacer Pr√©nom et Nom par Player"
"0","data1 <- data1 %>%"
"0","  mutate(Player = paste(Surname, Name, sep = "" ""))"
"0",""
"0","# Mettre en avant Player pour ne pas avoir √† passer 200 colonnes"
"0","data1 <- data1 %>%"
"0","  select(Rk, Player, Nation, Pos, Squad, Comp, Age, Born, Height, Weight, everything())"
"0",""
"0","# Supprimer Surname et Name"
"0","data1 <- data1 %>%"
"0","  select(-Surname, -Name)"
"0",""
"0","# cr√©er Age"
"0","data1 <- data1 %>%"
"0","  mutate(Age = 2022 - Born)"
"0",""
"0","# Afin de ne garder que les colonnes qui nous importent pour l'analyse"
"0","data1 <- data1 %>%"
"0","  select(Rk, Player, Nation, Pos, Squad, Comp, Age, Height, Weight, MP, Min, Goals,"
"0","         `SoT%`, `G/Sh`, ShoDist, PasTotCmp, PasTotAtt, Assists, PPA, CrsPA, SCA, "
"0","         GCA, GcaDrib, Press, DriAtt, `DriSucc%`, Fld, `AerWon%`)"
"0",""
"0","# Afin d'isoler les attaquants de Premier League"
"0","premier_league_players <- data1 %>%"
"0","  filter(Comp == ""Premier League"")"
"0",""
"0","# Afin d'isoler les attaquants de Bundesliga"
"0","bundesliga_players <- data1 %>%"
"0","  filter(Comp == ""Bundesliga"")"
"0",""
"0","# Afin d'isoler les attaquants de Ligue 1"
"0","ligue_1_players <- data1 %>%"
"0","  filter(Comp == ""Ligue 1"")"
"0",""
"0","# Afin d'isoler les attaquants de S√©rie A"
"0","serie_a_players <- data1 %>%"
"0","  filter(Comp == ""Serie A"")"
"0",""
"0","# Afin d'isoler les attaquants de La Liga"
"0","la_liga_players <- data1 %>%"
"0","  filter(Comp == ""La Liga"")"
"0",""
"0","# Cr√©er une nouvelle base de donn√©es normalis√©es afin d'avoir des % dans les colonnes et pour par la suite faire le radar plot"
"0","numeric_cols <- c(""Goals"", ""SoT%"", ""G/Sh"", ""ShoDist"", ""PasTotCmp"", ""PasTotAtt"", ""Assists"", ""PPA"", ""CrsPA"", ""SCA"", "
"0","                  ""GCA"", ""GcaDrib"", ""Press"", ""DriAtt"", ""DriSucc%"", ""Fld"", ""AerWon%"")"
"0",""
"0","normalized_data1 <- data1 %>%"
"0","  mutate(across(all_of(numeric_cols), ~ (. / max(., na.rm = TRUE)) * 100))"
"0",""
"0","# Afin d'isoler les attaquants de Premier League"
"0","norm_premier_league_players <- normalized_data1 %>%"
"0","  filter(Comp == ""Premier League"")"
"0",""
"0","# Afin d'isoler les attaquants de Bundesliga"
"0","norm_bundesliga_players <- normalized_data1 %>%"
"0","  filter(Comp == ""Bundesliga"")"
"0",""
"0","# Afin d'isoler les attaquants de Ligue 1"
"0","norm_ligue_1_players <- normalized_data1 %>%"
"0","  filter(Comp == ""Ligue 1"")"
"0",""
"0","# Afin d'isoler les attaquants de S√©rie A"
"0","norm_serie_a_players <- normalized_data1 %>%"
"0","  filter(Comp == ""Serie A"")"
"0",""
"0","# Afin d'isoler les attaquants de La Liga"
"0","norm_la_liga_players <- normalized_data1 %>%"
"0","  filter(Comp == ""La Liga"")"
